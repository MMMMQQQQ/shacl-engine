@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix ex: <http://example.com/ns#> .
@prefix sh: <http://www.w3.org/ns/shacl#>.
@prefix schema: <http://schema.org/#>.

ex:EmailsMustBeUnique
	a sh:GlobalNativeConstraint ;
	sh:message "There cannot be two persons with the same email address." ;
	sh:predicate schema:email ;
	sh:sparql """
		SELECT (?person1 AS ?subject) (?email AS ?object)
		WHERE {
			?person1 schema:email ?email .
			?person2 schema:email ?email .
			?person1 a schema:Person .
			?person2 a schema:Person .
			FILTER (?person1 != ?person2) .
		}
		""" .